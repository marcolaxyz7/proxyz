<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Próxyz - Área do Membro</title>
    
    <link rel="icon" href="./l.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; background-color: #050505; color: #ffffff; font-family: 'Roboto', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px; background: #000; border-right: 1px solid #222;
            display: flex; flex-direction: column; padding: 20px;
            flex-shrink: 0;
        }
        .sidebar-logo { display: flex; align-items: center; gap: 10px; margin-bottom: 40px; }
        .sidebar-logo img { height: 30px; }
        .sidebar-logo span { font-family: 'Oswald'; font-size: 1.2rem; letter-spacing: 2px; }

        .nav-btn {
            background: transparent; border: none; color: #888; text-align: left;
            padding: 12px 15px; width: 100%; cursor: pointer; font-size: 1rem;
            display: flex; align-items: center; gap: 10px; border-radius: 6px;
            transition: 0.3s; margin-bottom: 5px;
        }
        .nav-btn:hover { background: #111; color: white; }
        .nav-btn.active { background: #cc0000; color: white; }
        .nav-btn i { width: 20px; text-align: center; }

        .divider { height: 1px; background: #222; margin: 20px 0; }
        .cat-title { color: #555; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; padding-left: 15px; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
        
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 35px; height: 35px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #333; }
        .logout-btn { background: none; border: 1px solid #333; color: #888; padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; transition: 0.3s; }
        .logout-btn:hover { border-color: #cc0000; color: white; }

        /* VIEWS */
        .view-section { display: none; animation: fadeIn 0.5s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARD GRID (Igual ao anterior) */
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .dash-card { background: #0a0a0a; border: 1px solid #222; padding: 25px; border-radius: 8px; position: relative; transition: 0.3s; }
        .dash-card:hover { border-color: #cc0000; transform: translateY(-3px); }
        .card-badge { position: absolute; top: 15px; right: 15px; font-size: 0.7rem; color: #cc0000; border: 1px solid #cc0000; padding: 2px 6px; border-radius: 4px; }
        .copy-btn { width: 100%; padding: 10px; margin-top: 20px; background: #111; border: 1px solid #222; color: white; cursor: pointer; transition: 0.3s; }
        .copy-btn:hover { background: #cc0000; border-color: #cc0000; }

        /* VIDEO CONTAINER */
        .video-wrapper { 
            width: 100%; max-width: 800px; aspect-ratio: 16/9; background: #000; 
            border: 1px solid #333; display: flex; align-items: center; justify-content: center; 
            margin: 0 auto; color: #555;
        }

                /* --- MODAL DE MENSAGEM (Custom Alert) --- */
        #msgModal { z-index: 9999; } /* Fica acima de tudo, inclusive do login */

        .msg-icon { 
            font-size: 3rem; margin-bottom: 20px; display: block; 
        }
        .msg-success { color: #00ff00; text-shadow: 0 0 15px rgba(0, 255, 0, 0.5); }
        .msg-error { color: #cc0000; text-shadow: 0 0 15px rgba(204, 0, 0, 0.5); }
        .msg-info { color: #ffd700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }

        #msgTitle { font-family: 'Oswald'; font-size: 1.5rem; margin-bottom: 10px; text-transform: uppercase; }
        #msgText { color: #ccc; margin-bottom: 30px; font-size: 1rem; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-logo">
            <img src="l.png" alt="Logo">
            <span>PRÓXYZ</span>
        </div>

        <button class="nav-btn active" onclick="switchView('dashboard', this)">
            <i class="fa-solid fa-layer-group"></i> Dashboard
        </button>
        <button class="nav-btn" onclick="switchView('tutorial', this)">
            <i class="fa-solid fa-play-circle"></i> Como Usar (Vídeo)
        </button>

        <div class="divider"></div>
        <div class="cat-title">Categorias</div>

        <button class="nav-btn"><i class="fa-solid fa-bullhorn"></i> Marketing</button>
        <button class="nav-btn"><i class="fa-solid fa-code"></i> Dev / Code</button>
        <button class="nav-btn"><i class="fa-solid fa-palette"></i> Design IA</button>
        </aside>

    <main class="main-content">
        <div class="header-bar">
            <h2 id="page-title">MEUS PROMPTS</h2>
            <div class="user-info">
                <div class="user-avatar"><i class="fa-solid fa-user"></i></div>
                <span>Membro Pro</span>
                <button class="logout-btn" onclick="window.location.href='index.html'">SAIR</button>
            </div>
        </div>

        <div id="view-dashboard" class="view-section active">
            <div class="dash-grid">
                <div class="dash-card">
                    <span class="card-badge">MARKETING</span>
                    <h3>Copy AIDA Vendas</h3>
                    <p style="color:#888; font-size:0.9rem;">Framework clássico de Atenção, Interesse, Desejo e Ação.</p>
                    <button class="copy-btn"><i class="fa-solid fa-copy"></i> Copiar Prompt</button>
                </div>
                
                <div class="dash-card">
                    <span class="card-badge">DEV</span>
                    <h3>Refatorador Clean Code</h3>
                    <p style="color:#888; font-size:0.9rem;">Otimiza funções complexas para legibilidade.</p>
                    <button class="copy-btn"><i class="fa-solid fa-copy"></i> Copiar Prompt</button>
                </div>

                </div>
        </div>

        <div id="view-tutorial" class="view-section">
            <div class="video-wrapper">
                <div style="text-align:center;">
                    <i class="fa-brands fa-youtube" style="font-size:3rem; margin-bottom:10px;"></i>
                    <p>Vídeo Tutorial em Breve</p>
                </div>
            </div>
            <div style="max-width:800px; margin: 30px auto; color:#ccc; line-height:1.6;">
                <h3>Passo a Passo Rápido:</h3>
                <ol>
                    <li>Escolha a categoria no menu lateral.</li>
                    <li>Clique em "Copiar Prompt".</li>
                    <li>Cole na sua IA de preferência e substitua os [colchetes] pelos seus dados.</li>
                </ol>
            </div>
        </div>

        <div class="modal-overlay" id="msgModal" style="display: none;">
    <div class="auth-card" style="max-width: 400px; border-color: #333;">
        <i id="msgIcon" class="fa-solid fa-circle-exclamation msg-icon msg-info"></i>
        
        <h2 id="msgTitle">ATENÇÃO</h2>
        <p id="msgText">Mensagem do sistema aqui.</p>
        
        <button class="btn-main" onclick="closeMsgModal()" style="width: 100%;">ENTENDI</button>
    </div>
</div>

    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // --- FUNÇÕES DO MODAL (PRECISAM ESTAR AQUI TAMBÉM) ---
        function showMsg(title, text, type = 'info') {
            const modal = document.getElementById('msgModal');
            const icon = document.getElementById('msgIcon');
            const titleEl = document.getElementById('msgTitle');
            const textEl = document.getElementById('msgText');

            titleEl.innerText = title;
            textEl.innerText = text;

            icon.className = 'msg-icon fa-solid';
            if (type === 'success') icon.classList.add('fa-check-circle', 'msg-success');
            else if (type === 'error') icon.classList.add('fa-circle-xmark', 'msg-error');
            else icon.classList.add('fa-circle-exclamation', 'msg-info');

            modal.style.display = 'flex';
        }

        function closeMsgModal() {
            document.getElementById('msgModal').style.display = 'none';
        }

        // --- VERIFICAÇÃO DE SEGURANÇA ---
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            
            if (!token) {
                alert('Acesso Negado: Você precisa estar logado.');
                window.location.href = 'index.html';
                return;
            }

            // Carrega nome do usuário
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                document.querySelector('.user-info span').innerText = user.name;
            }

            // Carrega os Prompts
            loadPrompts(token);
        });

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        // --- LÓGICA DO DASHBOARD ---
        async function loadPrompts(token) {
            try {
                const res = await fetch(`${API_URL}/prompts`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!res.ok) throw new Error('Falha ao buscar prompts');
                
                const prompts = await res.json();
                renderPrompts(prompts);

            } catch (err) {
                console.error(err);
                if (err.message.includes('403') || err.message.includes('401')) {
                    logout();
                }
            }
        }

        function renderPrompts(prompts) {
            const grid = document.querySelector('.dash-grid');
            grid.innerHTML = ''; 

            prompts.forEach(prompt => {
                const card = document.createElement('div');
                card.className = 'dash-card';
                card.style.userSelect = 'none'; 
                
                card.innerHTML = `
                    <span class="card-badge">${prompt.category.toUpperCase()}</span>
                    <h3>${prompt.title}</h3>
                    <p style="color:#888; font-size:0.9rem; height:40px; overflow:hidden;">${prompt.description}</p>
                    <button class="copy-btn" onclick="copyToClipboard(this, '${prompt.content.replace(/'/g, "\\'")}')">
                        <i class="fa-solid fa-copy"></i> Copiar Prompt
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        function copyToClipboard(btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                showMsg('Copiado!', 'Prompt transferido para a área de transferência.', 'success');
            });
        }

        function switchView(viewId, btnElement) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.view-section').forEach(sec => sec.classList.remove('active'));

            if(btnElement) btnElement.classList.add('active');
            document.getElementById('view-' + viewId).classList.add('active');

            const title = document.getElementById('page-title');
            if(viewId === 'dashboard') title.innerText = 'MEUS PROMPTS';
            if(viewId === 'tutorial') title.innerText = 'COMO USAR';
        }
    </script>
</body>
</html>