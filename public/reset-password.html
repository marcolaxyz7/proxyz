<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redefinir Senha - Próxyz</title>
    <link rel="stylesheet" href="styleT1.css"> 
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #000; color: white; font-family: sans-serif; }
        .reset-card { background: #111; padding: 40px; border-radius: 10px; border: 1px solid #333; width: 100%; max-width: 400px; text-align: center; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
        button { width: 100%; padding: 12px; background: #e50914; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        button:hover { background: #ff1f2d; }
    </style>
</head>
<body>

    <div class="reset-card">
        <h2>Nova Senha</h2>
        <p>Digite sua nova senha abaixo.</p>
        
        <input type="password" id="newPass" placeholder="Nova Senha (mín. 8 caracteres)">
        <input type="password" id="confirmPass" placeholder="Confirme a Senha">
        
        <button onclick="resetPassword()">ALTERAR SENHA</button>
        <p id="statusMsg" style="margin-top: 15px; font-size: 0.9rem; color: #ccc;"></p>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api'; // Ajuste se necessário

        async function resetPassword() {
            // 1. Pega os parâmetros da URL (id e token)
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const token = urlParams.get('token');
            
            const password = document.getElementById('newPass').value;
            const confirm = document.getElementById('confirmPass').value;
            const msg = document.getElementById('statusMsg');

            // 2. Validações simples
            if (!id || !token) {
                msg.innerText = "Link inválido.";
                msg.style.color = "red";
                return;
            }
            if (password.length < 8) {
                msg.innerText = "A senha deve ter no mínimo 8 caracteres.";
                return;
            }
            if (password !== confirm) {
                msg.innerText = "As senhas não coincidem.";
                return;
            }

            msg.innerText = "Processando...";

            // 3. Envia para o servidor
            try {
                const res = await fetch(`${API_URL}/reset-password/${id}/${token}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await res.json();

                if (res.ok) {
                    msg.innerText = "Sucesso! Redirecionando para login...";
                    msg.style.color = "#0f0";
                    setTimeout(() => {
                        window.location.href = 'indexT1.html';
                    }, 2000);
                } else {
                    msg.innerText = data.error || "Erro ao alterar senha.";
                    msg.style.color = "red";
                }
            } catch (error) {
                msg.innerText = "Erro de conexão.";
                msg.style.color = "red";
            }
        }
    </script>
</body>
</html>